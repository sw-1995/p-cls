# 功能規格：AI 檢索 MVP - 快速見效功能

## 概述

### 目的

此 MVP 專注於**快速見效功能**，以最少的基礎建設投資解決最痛苦的專利檢索瓶頸。我們不建構複雜的語義模型和多語言管道，而是從高影響力功能開始，利用現有的 PatentCloud 資料和經過驗證的 NLP 技術。

### MVP 理念：80/20 法則

**目標：** 透過優先處理以下項目，以 20% 的努力提供 80% 的使用者價值：
- 使用**現有資料**的功能（無需新語料庫收集）
- **確定性演算法**（無需複雜的 ML 模型訓練）
- **UI/UX 改進**（透明的建議、進度指示器）
- **快速反饋循環**（使用者接受/拒絕驅動迭代）

### 目標（8 週 MVP）

1. **減少查詢建構時間 40%** - 從現有同義詞庫自動擴展同義詞
2. **增加分類覆蓋率 25%** - 從階層結構建議相鄰的 CPC/IPC 分類
3. **提高受讓人檢索準確度 60%** - 標準化常見的受讓人名稱變體
4. **降低使用者挫折感 50%** - 透明的進度指示器和逃生出口

### 非目標（延後至未來階段）

- ❌ 語義檢索（需要訓練/託管大型嵌入模型）
- ❌ 多語言查詢擴展（需要翻譯基礎設施）
- ❌ 主動學習排名（需要反饋資料收集管道）
- ❌ NPL 整合（需要 API 授權和法律審查）
- ❌ 專業化學/生物技術功能

---

## 快速見效功能選擇

### 功能優先順序矩陣

| **功能** | **影響力** | **複雜度** | **價值實現時間** | **優先級** |
|-------------|-----------|---------------|-------------------|--------------|
| **1. 同義詞擴展（基於同義詞庫）** | 高 | 低 | 2 週 | **P0** |
| **2. 受讓人名稱標準化** | 高 | 低 | 1 週 | **P0** |
| **3. 相鄰分類建議** | 高 | 中 | 2 週 | **P0** |
| **4. 查詢品質反饋** | 中 | 低 | 1 週 | **P1** |
| **5. 進度指示器與逃生出口** | 中 | 低 | 1 週 | **P1** |
| **6. 檢索歷史與快速重試** | 中 | 低 | 1 週 | **P1** |
| **7. 專利家族去重 UI** | 中 | 中 | 2 週 | **P2** |

**MVP 總範圍：** P0 + P1 功能 = **8 週**

---

## MVP 功能詳細規格

### 功能 1：同義詞擴展（基於同義詞庫）[P0]

**解決的瓶頸：** 詞彙不匹配（同義詞、術語、縮寫）

**為何是快速見效：**
- 利用**現有專利同義詞庫資料**（無需訓練）
- 簡單的字串匹配和擴展邏輯
- 透明的 UI（使用者看到所有建議）
- 無推理延遲（預先計算的查找表）

#### 需求

**FR1.1: 技術術語偵測**
- 使用簡單的 NLP（spaCy NER）識別技術名詞短語
- 縮寫的模式匹配（全大寫單詞，例如 "BMS"、"IoT"）
- 複合術語偵測（例如將 "battery management system" 視為單一單元）

**FR1.2: 同義詞庫查找**
- 使用 PatentCloud 現有的 CPC/IPC 術語同義詞庫
- 回退到 WordNet 用於一般技術術語
- 包含常見縮寫擴展（手動整理的前 500 個專利縮寫清單）

**FR1.3: 擴展 UI**
```
原始查詢："BMS for lithium-ion batteries"

AI 建議：
┌────────────────────────────────────────────────────────────┐
│ 偵測到的同義詞                                               │
├────────────────────────────────────────────────────────────┤
│ ☑ BMS → Battery Management System（電池管理系統）           │
│ ☐ BMS → Building Management System（建築管理系統，點擊納入）│
│ ☑ lithium-ion → Li-ion、lithium ion（鋰離子）             │
│ ☑ batteries → cell、energy storage、accumulator（電池）   │
│                                                             │
│ 增強查詢預覽：                                               │
│ (BMS OR "Battery Management System") AND                   │
│ ("lithium-ion" OR "Li-ion" OR "lithium ion") AND          │
│ (batteries OR cell OR "energy storage")                   │
│                                                             │
│ 預估結果數：約 5,200 件專利（原為 1,800）                    │
└────────────────────────────────────────────────────────────┘
```

**FR1.4: 使用者控制**
- 勾選/取消勾選個別同義詞建議
- 「全部接受」和「全部拒絕」按鈕
- 擴展選擇的撤銷/重做功能
- 「記住我的偏好」用於常見術語（例如，始終將 "BMS" 擴展為 Battery）

#### 技術設計

**資料來源：**
```json
// synonym_thesaurus.json（從 CPC 定義 + 手動整理預先建置）
{
  "BMS": {
    "expansions": [
      { "term": "Battery Management System", "domain": "electrical", "confidence": 0.95 },
      { "term": "Building Management System", "domain": "construction", "confidence": 0.85 }
    ],
    "default_selection": ["Battery Management System"]  // 自動勾選
  },
  "lithium-ion": {
    "expansions": [
      { "term": "Li-ion", "confidence": 0.98 },
      { "term": "lithium ion", "confidence": 0.95 }
    ]
  }
}
```

**API 端點：**
```http
POST /api/v1/query/expand-synonyms
{
  "query": "BMS for lithium-ion batteries",
  "domain_hint": "electrical"  // 選填，來自使用者設定檔或 CPC 篩選器
}

回應：
{
  "expansions": [
    {
      "original": "BMS",
      "suggestions": [
        { "term": "Battery Management System", "checked": true, "confidence": 0.95 },
        { "term": "Building Management System", "checked": false, "confidence": 0.85 }
      ]
    },
    ...
  ],
  "enhanced_query": "(BMS OR \"Battery Management System\") AND ...",
  "estimated_results": 5200
}
```

**實作工作量：** 2 週
- 第 1 週：從 CPC/IPC 術語建置同義詞庫 + 整理前 500 個縮寫
- 第 2 週：API 端點 + 前端 UI 與核取方塊控制項

**成功指標：**
- 建議的使用者接受率達 70% 以上
- 查詢重新制定嘗試減少 40% 以上
- 檢索結果增加 30% 以上（召回率改進）

---

### 功能 2：受讓人名稱標準化 [P0]

**解決的瓶頸：** 資料品質問題（受讓人名稱不一致）

**為何是快速見效：**
- PatentCloud 已有受讓人資料
- 簡單的模糊字串匹配（無需 ML）
- 高使用者痛點（檢索 "IBM" 會錯過 "International Business Machines Corp."）
- 立即可見的效益

#### 需求

**FR2.1: 受讓人變體偵測**
- 將受讓人輸入與 PatentCloud 的受讓人資料庫進行模糊匹配
- 偵測常見模式：
  - 法律後綴："Inc."、"Corp."、"Co., Ltd."、"GmbH"
  - 縮寫："IBM" ↔ "International Business Machines"
  - 收購："Motorola" → "Google"（2012-2014）→ "Lenovo"（2014+）

**FR2.2: 統一檢索 UI**
```
受讓人檢索："Samsung"

AI 偵測到的變體：
┌────────────────────────────────────────────────────────────┐
│ ☑ Samsung Electronics Co., Ltd.        (45,234 件專利)    │
│ ☑ Samsung Display Co., Ltd.            (12,456 件專利)    │
│ ☑ Samsung SDI Co., Ltd.                (8,901 件專利)     │
│ ☑ 삼성전자（Samsung Electronics KR）     (23,112 件專利)    │
│ ☐ Samsung Heavy Industries              (3,456 件專利)     │
│                                                             │
│ 已選擇總數：89,703 件專利                                    │
│ [使用選定的變體進行檢索]                                      │
└────────────────────────────────────────────────────────────┘
```

**FR2.3: 受讓人知識庫**
- 前 1,000 名受讓人的預先建置對應表
- 手動整理收購歷史（例如 Motorola → Google → Lenovo）
- 使用者貢獻的更正（群眾外包）

#### 技術設計

**資料來源：**
```json
// assignee_variants.json
{
  "Samsung Electronics": {
    "variants": [
      "Samsung Electronics Co., Ltd.",
      "Samsung Electronics Co Ltd",
      "Samsung Display Co., Ltd.",
      "Samsung SDI Co., Ltd.",
      "삼성전자"
    ],
    "subsidiaries": ["Samsung Display", "Samsung SDI"],
    "acquisition_history": []
  },
  "IBM": {
    "variants": [
      "International Business Machines",
      "International Business Machines Corporation",
      "IBM Corp.",
      "I.B.M."
    ],
    "acquisition_history": [
      { "acquired": "Red Hat", "date": "2019-07-09" }
    ]
  }
}
```

**模糊匹配演算法：**
- 使用 `fuzzywuzzy` 函式庫（Levenshtein 距離）
- 閾值：85% 以上的相似度分數
- 匹配前移除法律後綴（"Inc."、"Corp."、"Ltd."）

**API 端點：**
```http
POST /api/v1/assignee/normalize
{
  "assignee": "Samsung"
}

回應：
{
  "normalized_name": "Samsung Electronics",
  "variants": [
    { "name": "Samsung Electronics Co., Ltd.", "patent_count": 45234, "checked": true },
    { "name": "Samsung Display Co., Ltd.", "patent_count": 12456, "checked": true },
    ...
  ],
  "total_patents": 89703
}
```

**實作工作量：** 1 週
- 第 1-2 天：從 PatentCloud 資料建置受讓人變體資料庫
- 第 3-4 天：實作模糊匹配 API
- 第 5 天：前端 UI 與核取方塊選擇

**成功指標：**
- 受讓人檢索「無結果」減少 60% 以上
- 變體建議的使用者接受率達 80% 以上
- 前 100 名受讓人的變體覆蓋率達 95% 以上

---

### 功能 3：相鄰分類建議 [P0]

**解決的瓶頸：** 分類複雜性（缺少相鄰/父類別）

**為何是快速見效：**
- CPC/IPC 階層結構公開可用（無需資料收集）
- 簡單的圖遍歷演算法（無需 ML）
- 高影響力（使用者經常錯過 1-2 層級的相關類別）
- 透明的解釋（「也在父類別 H01M 中」）

#### 需求

**FR3.1: 分類階層導覽**
- 將 CPC/IPC 階層結構載入為有向圖
- 給定使用者選擇的類別（例如 H01M10/42），建議：
  - **父類別：** H01M10、H01M（更廣泛的範圍）
  - **同級類別：** H01M10/44、H01M10/48（同一層級）
  - **子類別：** H01M10/425、H01M10/4235（更窄的範圍）

**FR3.2: 帶理由的建議 UI**
```
選定的分類：H01M10/42（電池監控）

AI 建議：
┌────────────────────────────────────────────────────────────┐
│ 擴展至相關分類                                               │
├────────────────────────────────────────────────────────────┤
│ ☑ H01M10/48 - 電池測試（同級，2,345 件專利）                │
│   理由：通常與監控系統配對                                    │
│                                                             │
│ ☐ H01M10 - 電池結構（父類別，45,678 件專利）                 │
│   理由：更廣泛的範圍，包括所有電池技術                         │
│                                                             │
│ ☑ G01R31/36 - 電池測量（交叉參考，1,234 件）                │
│   理由：監控的測量技術                                        │
│                                                             │
│ ☐ H02J7/00 - 充電電路（相關，8,901 件專利）                  │
│   理由：充電通常需要監控                                      │
└────────────────────────────────────────────────────────────┘
```

**FR3.3: 分類覆蓋率視覺化**
```
按分類的結果分佈：
┌────────────────────────────────────────────────────────────┐
│ H01M10/42 ████████████████████████░░░░ 60%（3,456 件專利） │
│ H01M10/48 ██████░░░░░░░░░░░░░░░░░░ 15%（863 件專利）      │
│ G01R31/36 ████░░░░░░░░░░░░░░░░░░░░ 10%（576 件專利）      │
│ H02J7/00  ██░░░░░░░░░░░░░░░░░░░░░░  5%（288 件專利）      │
│ 其他      ██████░░░░░░░░░░░░░░░░░░ 10%（576 件專利）      │
│                                                             │
│ 💡 提示：40% 的結果在您的主要類別之外                        │
│    考慮添加 H01M10/48 以提高召回率                           │
└────────────────────────────────────────────────────────────┘
```

#### 技術設計

**資料來源：**
- CPC/IPC XML 階層結構檔案（EPO/USPTO 公開可用）
- 預處理為圖資料庫（Neo4j）或 JSON 結構

**圖表示：**
```json
{
  "H01M10/42": {
    "label": "電池的監控或測試",
    "parent": "H01M10",
    "siblings": ["H01M10/44", "H01M10/48"],
    "children": ["H01M10/425", "H01M10/4285"],
    "cross_references": ["G01R31/36", "H02J7/00"],
    "patent_count": 3456
  }
}
```

**API 端點：**
```http
POST /api/v1/classification/suggest-adjacent
{
  "selected_classes": ["H01M10/42"],
  "max_suggestions": 5
}

回應：
{
  "suggestions": [
    {
      "class": "H01M10/48",
      "label": "電池測試",
      "relationship": "sibling",
      "patent_count": 2345,
      "rationale": "通常與監控系統配對"
    },
    ...
  ]
}
```

**實作工作量：** 2 週
- 第 1 週：從 XML 建置 CPC/IPC 階層圖，計算關係
- 第 2 週：API 端點 + 前端視覺化

**成功指標：**
- 每次檢索會話探索的分類增加 25% 以上
- 50% 以上的使用者接受至少一個相鄰類別建議
- 多類別檢索的召回率提高 20% 以上

---

### 功能 4：查詢品質反饋 [P1]

**解決的瓶頸：** 缺乏經驗的檢索策略（沒有查詢品質反饋）

**為何是快速見效：**
- 簡單的啟發式規則（無需 ML）
- 即時反饋（無 API 延遲）
- 教育價值（幫助新手學習）

#### 需求

**FR4.1: 查詢分析啟發式**

偵測常見的查詢問題：
1. **過於寬泛：** 單一通用術語（例如 "battery"）→ 500K+ 結果
2. **過於狹窄：** 太多 AND（例如 "battery AND lithium AND charging AND BMS AND safety"）→ <10 結果
3. **缺少分類：** 寬泛檢索上沒有 CPC/IPC 篩選器
4. **模糊縮寫：** "BMS"、"AI"、"ML" 沒有上下文
5. **不正確的運算子：** 使用 OR 而意圖是 AND（例如 "battery OR charger" 可能想要兩者）

**FR4.2: 反饋 UI**
```
查詢："AI"

⚠️ 偵測到查詢品質問題：
┌────────────────────────────────────────────────────────────┐
│ 🔴 查詢過於寬泛                                              │
│ "AI" 在所有技術領域返回 120 萬件專利。                        │
│                                                             │
│ 建議：                                                       │
│ • 添加分類篩選器（例如 G06N 用於 AI/ML）                     │
│ • 指定應用領域（例如 "AI for medical"）                      │
│ • 縮小到特定技術（例如 "neural network"）                    │
│                                                             │
│ ⚠️ 模糊縮寫                                                  │
│ "AI" 可能表示：                                              │
│ • Artificial Intelligence（人工智慧，專利中最常見）           │
│ • Analog Instruments（類比儀器）                             │
│                                                             │
│ [應用建議的改進] [仍然繼續]                                   │
└────────────────────────────────────────────────────────────┘
```

**FR4.3: 教育性工具提示**
- 解釋為何提出建議
- 連結到檢索最佳實踐指南
- 顯示改進查詢的範例

#### 技術設計

**啟發式規則（客戶端 JavaScript）：**
```javascript
function analyzeQueryQuality(query, estimatedResults) {
  const issues = [];

  // 過於寬泛偵測
  if (estimatedResults > 100000) {
    issues.push({
      severity: "error",
      type: "over_broad",
      message: `查詢返回 ${estimatedResults.toLocaleString()} 件專利。考慮添加篩選器。`,
      suggestions: ["添加分類篩選器", "指定應用領域"]
    });
  }

  // 模糊縮寫偵測
  const ambiguousAcronyms = ["AI", "ML", "BMS", "IoT", "EV"];
  for (const acronym of ambiguousAcronyms) {
    if (query.includes(acronym) && !query.includes('"')) {
      issues.push({
        severity: "warning",
        type: "ambiguous_acronym",
        message: `"${acronym}" 可能有歧義`,
        suggestions: [`擴展為完整術語`, `添加分類篩選器`]
      });
    }
  }

  return issues;
}
```

**無需 API** - 所有邏輯在客戶端執行以實現即時反饋

**實作工作量：** 1 週
- 第 1-3 天：建置啟發式規則函式庫
- 第 4-5 天：前端 UI 整合

**成功指標：**
- 50% 以上有品質問題的使用者接受至少一個建議
- 「無結果」錯誤減少 30%
- 過於寬泛的檢索（>100K 結果）減少 40%

---

### 功能 5：進度指示器與逃生出口 [P1]

**解決的瓶頸：** 使用者對不明確的處理時間感到挫折

**為何是快速見效：**
- 純 UI/UX 改進（無需後端更改）
- 符合憲法 v1.1.0（透明度的效能）
- 高使用者滿意度影響

#### 需求

**FR5.1: 具體進度訊息**
```
AI 檢索進行中...

┌────────────────────────────────────────────────────────────┐
│ ⚙️ 正在分析查詢...                    ✅ 完成（0.5 秒）     │
│ 🔍 正在擴展同義詞...                  ⏳ 進行中            │
│ 🏷️ 正在對應分類...                   ⏸️ 待處理            │
│ 🌐 正在檢索專利資料庫...              ⏸️ 待處理            │
│ 📊 正在排序結果...                    ⏸️ 待處理            │
│                                                             │
│ 預估剩餘時間：6 秒                                           │
│                                                             │
│ [跳過 AI 增強 - 立即顯示基本結果]                            │
└────────────────────────────────────────────────────────────┘
```

**FR5.2: 逃生出口按鈕**
- 始終可見的「跳過 AI 增強」按鈕
- 回退到基本關鍵字檢索
- 顯示使用者錯過的內容（例如「跳過了同義詞擴展」）

**FR5.3: 預估時間顯示**
- 如果處理時間 > 3 秒，顯示倒數計時器
- 根據已完成的階段更新進度條

#### 技術設計

**前端狀態機：**
```javascript
const searchStages = [
  { name: "正在分析查詢", duration: 500 },
  { name: "正在擴展同義詞", duration: 1500 },
  { name: "正在對應分類", duration: 2000 },
  { name: "正在檢索專利資料庫", duration: 4000 },
  { name: "正在排序結果", duration: 2000 }
];

function ProgressIndicator({ currentStage, onSkip }) {
  const totalDuration = searchStages.reduce((sum, s) => sum + s.duration, 0);
  const elapsed = searchStages.slice(0, currentStage).reduce((sum, s) => sum + s.duration, 0);
  const remaining = totalDuration - elapsed;

  return (
    <div>
      <ProgressBar percent={elapsed / totalDuration * 100} />
      <p>預估剩餘時間：{remaining / 1000} 秒</p>
      <button onClick={onSkip}>跳過 AI 增強</button>
    </div>
  );
}
```

**實作工作量：** 1 週
- 第 1-2 天：設計進度 UI 元件
- 第 3-4 天：實作階段追蹤和時間估算
- 第 5 天：與現有檢索流程整合

**成功指標：**
- < 5% 的使用者點擊「跳過」按鈕（表示等待時間可接受）
- 80% 以上的使用者對檢索響應性滿意
- 零有關「懸掛」或「無反饋」的投訴

---

### 功能 6：檢索歷史與快速重試 [P1]

**解決的瓶頸：** 缺乏迭代循環（使用者丟失先前的查詢嘗試）

**為何是快速見效：**
- 簡單的資料庫持久性（PostgreSQL/Redis）
- 標準的「最近檢索」UI 模式
- 啟用查詢變體的 A/B 比較

#### 需求

**FR6.1: 持久性檢索歷史**
- 每個使用者保存最後 50 次檢索
- 包括查詢字串、篩選器、結果數、時間戳記
- 快速重新載入先前的檢索

**FR6.2: 帶比較的歷史 UI**
```
檢索歷史（最近 7 天）

┌────────────────────────────────────────────────────────────┐
│ 🕐 2 小時前                                                  │
│ "battery management system" + H01M10/42                    │
│ 1,234 件結果 • [重新載入] [與目前比較]                        │
│                                                             │
│ 🕐 昨天                                                      │
│ "BMS"（無篩選器）                                            │
│ 45,678 件結果 • [重新載入] [與目前比較]                       │
│                                                             │
│ 🕐 3 天前                                                    │
│ "battery state of charge" + H01M10/42                      │
│ 2,345 件結果 • [重新載入] [與目前比較]                        │
└────────────────────────────────────────────────────────────┘

💡 注意：將 "BMS" 擴展為 "battery management system"
   將結果減少了 97%（45,678 → 1,234）。考慮使用篩選器！
```

**FR6.3: 並排比較**
```
┌────────────────────────┬────────────────────────┐
│ 查詢 A（目前）          │ 查詢 B（昨天）          │
├────────────────────────┼────────────────────────┤
│ "battery management    │ "BMS"                  │
│  system" + H01M10/42   │（無篩選器）             │
│                        │                        │
│ 1,234 件結果            │ 45,678 件結果           │
│ 首要結果：              │ 首要結果：              │
│ US10234567（相關：0.95）│ US98765432（相關：0.42）│
│                        │                        │
│ 分類：                  │ 分類：                  │
│ H01M10/42（60%）       │ H01M10/42（2%）        │
│ G01R31/36（20%）       │ H02J7/00（15%）        │
│                        │ B60L（30%）            │
│                        │ 其他（53%）            │
└────────────────────────┴────────────────────────┘

✅ 查詢 A 更加聚焦（更好的精確度）
⚠️ 查詢 B 可能有更好的召回率但相關性較低
```

#### 技術設計

**資料模型：**
```typescript
interface SearchHistoryEntry {
  searchId: string;
  userId: string;
  timestamp: Date;
  query: {
    raw: string;
    enhanced: string;
    filters: {
      classifications: string[];
      dateRange: { start: Date, end: Date };
      assignees: string[];
    };
  };
  results: {
    count: number;
    topPatents: string[];  // 前 10 個專利 ID
    classificationDistribution: { class: string, count: number }[];
  };
}
```

**API 端點：**
```http
GET /api/v1/search/history?limit=50
POST /api/v1/search/compare?searchIdA=abc&searchIdB=def
```

**實作工作量：** 1 週
- 第 1-2 天：資料庫模式和 API 端點
- 第 3-5 天：前端歷史清單和比較 UI

**成功指標：**
- 40% 以上的使用者在會話內重新載入先前的檢索
- 20% 以上的使用者使用比較功能
- 冗餘檢索嘗試減少 30%

---

### 功能 7：專利家族去重 UI [P2]

**解決的瓶頸：** 資料品質（家族膨脹、重複檢視）

**為何中等優先級：**
- PatentCloud 已有家族資料（INPADOC）
- 簡單的去重邏輯
- 對景觀分析使用者的高價值
- 低於 P0/P1 的優先級（不會阻礙基本檢索）

#### 需求

**FR7.1: 家族分組切換**
```
結果：1,234 件專利（345 個唯一家族）

顯示模式：○ 顯示所有專利  ● 每個家族顯示一件

┌────────────────────────────────────────────────────────────┐
│ 📄 US10234567B2 - 電池監控系統                              │
│ 👥 家族：12 個成員（US、EP、JP、CN、KR...）                  │
│ [擴展家族] [顯示所有司法管轄區]                               │
│                                                             │
│ 優先權：US2018/123456（2018-05-01）                         │
│ 受讓人：Tesla Inc.                                          │
│ 關鍵請求項：[自動擷取摘要]                                    │
└────────────────────────────────────────────────────────────┘
```

**FR7.2: 按需家族擴展**
```
📄 US10234567B2 - 電池監控系統
👥 家族成員（12）：

┌────────────────────────────────────────────────────────────┐
│ ✅ US10234567B2（美國授權，2020-03-15）                     │
│ ☐ EP3456789A1（歐洲申請，2019-11-20）                      │
│ ☐ JP2020-123456A（日本申請，2020-01-10）                   │
│ ☐ CN109876543A（中國申請，2019-12-05）                     │
│ ... 還有 8 個成員                                            │
│                                                             │
│ [在新標籤頁檢視全部] [將選定項目加入結果]                     │
└────────────────────────────────────────────────────────────┘
```

**FR7.3: 代表性成員選擇**
- 優先選擇授權專利而非申請
- 優先選擇英語而非翻譯
- 優先選擇最近的公告
- 允許使用者覆寫

#### 技術設計

**資料查詢：**
```sql
SELECT
  p.patent_id,
  f.family_id,
  f.family_size,
  p.publication_date,
  p.legal_status
FROM patents p
JOIN patent_families f ON p.family_id = f.family_id
WHERE p.is_representative = TRUE  -- 預先計算的標誌
ORDER BY relevance_score DESC;
```

**API 端點：**
```http
GET /api/v1/search/results?deduplicate_families=true
GET /api/v1/patent/{patentId}/family
```

**實作工作量：** 2 週
- 第 1 週：去重和家族擴展的 API 邏輯
- 第 2 週：前端切換和家族擴展 UI

**成功指標：**
- 60% 以上的景觀分析使用者啟用家族去重
- 重複專利檢視減少 50%
- 更快的結果篩選（透過檢視前 100 項的時間測量）

---

## 8 週實作計畫

### 衝刺 1-2（第 1-2 週）：基礎 [P0]
**目標：** 同義詞擴展 + 受讓人標準化

**第 1 週：**
- [x] 第 1-2 天：從 CPC 定義建置同義詞庫
- [x] 第 3 天：整理前 500 個專利縮寫
- [x] 第 4-5 天：同義詞擴展 API 端點

**第 2 週：**
- [x] 第 1-2 天：建置受讓人變體資料庫
- [x] 第 3 天：模糊匹配 API
- [x] 第 4 天：同義詞核取方塊選擇的前端 UI
- [x] 第 5 天：受讓人變體選擇的前端 UI

**交付成果：** 使用者可以擴展同義詞並檢索統一的受讓人名稱

---

### 衝刺 3-4（第 3-4 週）：分類智能 [P0]
**目標：** 相鄰分類建議

**第 3 週：**
- [x] 第 1-3 天：將 CPC/IPC XML 階層結構解析為圖
- [x] 第 4-5 天：計算父/同級/交叉參考關係

**第 4 週：**
- [x] 第 1-2 天：相鄰類別建議的 API 端點
- [x] 第 3-4 天：前端分類建議 UI
- [x] 第 5 天：結果分佈視覺化

**交付成果：** 使用者看到帶理由和覆蓋率統計的相鄰類別

---

### 衝刺 5-6（第 5-6 週）：UX 精煉 [P1]
**目標：** 查詢品質反饋 + 進度指示器 + 檢索歷史

**第 5 週：**
- [x] 第 1-2 天：建置查詢品質啟發式規則
- [x] 第 3-4 天：前端反饋 UI（警告、建議）
- [x] 第 5 天：進度指示器狀態機

**第 6 週：**
- [x] 第 1-2 天：進度指示器 UI 元件
- [x] 第 3-4 天：檢索歷史資料庫模式和 API
- [x] 第 5 天：檢索歷史清單 UI

**交付成果：** 使用者收到即時品質反饋、看到進度並可重新載入檢索

---

### 衝刺 7-8（第 7-8 週）：測試與精煉 [P1 + P2]
**目標：** 整合測試、錯誤修復、家族去重

**第 7 週：**
- [x] 第 1-3 天：所有 P0/P1 功能的端對端測試
- [x] 第 4-5 天：錯誤修復和效能最佳化

**第 8 週：**
- [x] 第 1-3 天：專利家族去重（P2）
- [x] 第 4 天：Beta 使用者測試會話（內部）
- [x] 第 5 天：文件和部署準備

**交付成果：** 具有 7 個快速見效功能的生產就緒 MVP

---

## 成功指標（8 週 MVP）

### 使用者影響指標

| 指標 | 基準 | MVP 目標 | 測量 |
|--------|----------|------------|-------------|
| **查詢建構時間** | 平均 10 分鐘 | 6 分鐘（-40%） | 從查詢輸入到首次檢索執行的時間 |
| **分類覆蓋率** | 1.5 個類別/檢索 | 2.0 個類別（+25%） | 每次會話探索的平均分類數 |
| **受讓人檢索準確度** | 40% 找到所有變體 | 90%（+60%） | 找到統一受讓人結果的使用者百分比 |
| **使用者滿意度（CSAT）** | 65% | 80%（+15 點） | 檢索後調查評分 |
| **「無結果」錯誤率** | 12% | 6%（-50%） | 返回零結果的檢索百分比 |

### 功能採用指標

| 功能 | 目標採用率 | 成功閾值 |
|---------|----------------|-------------------|
| 同義詞擴展 | 60% 的檢索 | 接受 ≥1 個建議 |
| 受讓人標準化 | 70% 的受讓人檢索 | 選擇 ≥1 個變體 |
| 相鄰分類 | 40% 的檢索 | 添加 ≥1 個相鄰類別 |
| 查詢品質反饋 | 50% 被標記的查詢 | 接受 ≥1 個建議 |
| 檢索歷史重新載入 | 30% 的使用者 | 重新載入 ≥1 個先前檢索 |

### 技術效能指標

| 指標 | 目標 | 警報閾值 |
|--------|--------|-----------------|
| **同義詞擴展延遲** | < 1 秒 P95 | > 2 秒 |
| **受讓人標準化延遲** | < 500 毫秒 P95 | > 1 秒 |
| **分類建議延遲** | < 2 秒 P95 | > 3 秒 |
| **總 AI 增強時間** | < 5 秒 P95 | > 10 秒 |
| **API 錯誤率** | < 0.5% | > 1% |

---

## 測試策略（MVP）

### 單元測試（80% 以上覆蓋率）

**關鍵路徑：**
1. 同義詞擴展：縮寫偵測、同義詞庫查找、多術語擴展
2. 受讓人標準化：模糊匹配準確度、法律後綴移除
3. 分類圖：父/同級/子遍歷正確性
4. 查詢品質：啟發式規則準確度（過於寬泛、過於狹窄偵測）

**測試框架：** `pytest` + 資料庫呼叫的模擬

---

### 整合測試

**測試場景：**
1. **端對端同義詞流程：** 使用者輸入查詢 → API 返回建議 → 使用者選擇 → 執行增強查詢
2. **受讓人檢索：** 使用者輸入 "Samsung" → 系統找到 5 個變體 → 使用者選擇 3 個 → 檢索返回統一結果
3. **分類探索：** 使用者選擇 H01M10/42 → 系統建議 H01M10/48 → 使用者接受 → 結果包括兩個類別

**測試框架：** `pytest` 與測試資料庫（PostgreSQL）

---

### 使用者驗收測試（Beta）

**Beta 使用者：** 20 名內部 PatentCloud 使用者（審查員、律師、研究人員的混合）

**測試期間：** 1 週（第 8 週）

**反饋收集：**
- 每日調查：功能使用、遇到的錯誤、滿意度分數
- 週末訪談：定性反饋、功能請求
- 使用分析：點擊率、接受率、節省時間

**UAT 退出標準：**
- 80% 以上的使用者滿意度
- < 5 個嚴重錯誤
- 60% 以上的功能採用率（每次檢索至少接受一個 AI 建議）

---

## 推出計畫（第 9 週以後）

### 軟啟動（第 9 週）
- **受眾：** 10% 的 PatentCloud 使用者（隨機選擇）
- **功能標誌：** 預設啟用所有 7 個功能，使用者可在設定中停用
- **監控：** 延遲、錯誤、採用率的即時儀表板

### 完全推出（第 10 週）
- **受眾：** 100% 的使用者
- **行銷：** 部落格文章、電子郵件公告、應用程式內教學
- **支援：** 常見問題、影片指南、客戶成功拓展

### 啟動後（第 11 週以後）
- **迭代：** 收集使用者反饋，優先處理下一個功能（語義檢索、多語言等）
- **模型改進：** 精煉同義詞庫，擴展受讓人資料庫
- **文件：** 更新使用者指南，建立進階檢索教學

---

## 開放問題（MVP 範圍）

1. **同義詞庫覆蓋範圍：**
   - 我們應該眾包使用者貢獻的同義詞，還是只保留整理的？
   - **需要決定時間：** 第 2 週（影響資料品質策略）

2. **受讓人收購追蹤：**
   - 我們應該多久更新一次收購歷史資料庫？
   - **需要決定時間：** 第 2 週（影響資料刷新管道）

3. **分類建議限制：**
   - 我們應該建議多少個相鄰類別？（目前：5）
   - **需要決定時間：** 第 4 週（影響 UI 設計）

4. **進度指示器粒度：**
   - 我們應該顯示即時進度（WebSocket）還是預估階段？
   - **需要決定時間：** 第 6 週（影響基礎設施）

5. **檢索歷史保留：**
   - 我們應該保留檢索歷史多久？（30 天？90 天？永久？）
   - **需要決定時間：** 第 6 週（影響儲存成本和隱私政策）

---

## 狀態

- [ ] 規格審查（憲法合規檢查）
- [ ] 設計審查（API 和 UI/UX）
- [ ] 衝刺 1-2 完成（同義詞 + 受讓人）
- [ ] 衝刺 3-4 完成（分類）
- [ ] 衝刺 5-6 完成（UX 精煉）
- [ ] 衝刺 7-8 完成（測試 + P2）
- [ ] UAT 完成（Beta 反饋正面）
- [ ] 部署至生產環境

---

## 變更日誌

| 日期       | 作者 | 變更                                      |
|------------|--------|----------------------------------------------|
| 2025-10-19 | AI     | 專注於快速見效的 MVP 規格 |

---

**建立日期：** 2025-10-19
**最後更新：** 2025-10-19
**負責人：** AI Search Team (PatentCloud by InQuartik)
**憲法對齊：** v1.1.0
**相關文件：** `ai-search-feature.md`（完整路線圖）
