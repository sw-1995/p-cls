# 功能規格：AI 檢索 MVP v2 - 利用現有向量嵌入

## 概述

### 目的

此 **MVP v2** 將語義檢索提升為**核心功能**，結合現有的快速見效功能，打造一個真正智能的專利檢索系統。透過利用 Solr 中已有的向量嵌入，我們可以在**相同的 8 週時間框架**內交付更強大的 AI 檢索能力。

### MVP 理念：槓桿現有資產

**新策略：** 最大化利用 PatentCloud 已有的投資：

- ✅ **Solr 向量嵌入** - 語義相似度檢索（零額外成本）
- ✅ **CPC/IPC 階層** - 分類導覽（公開資料）
- ✅ **受讓人資料庫** - 名稱標準化（現有資料）
- ✅ **專利家族資料** - 去重功能（INPADOC）

### 目標（8 週 MVP v2）

1. **減少查詢建構時間**- 同義詞擴展 + **語義查詢理解**
2. **增加召回率**- 分類建議 + **向量相似度檢索**
3. **提高受讓人檢索準確度** - 標準化變體
4. **降低誤報篩選時間** - **語義排名** + 聚類
5. **使用者滿意度提升**（原 80%）- 更智能的結果
6. **發現隱藏先前技術** - 跨分類語義檢索（非關鍵字匹配）
7. **支援概念檢索** - 「類似此專利」功能（單點擊擴展）
8. **自動查詢改寫** - 將自然語言轉換為最佳檢索策略

---

## 更新後的功能優先順序矩陣

### 功能優先順序（含語義檢索）

| **功能** | **影響力** | **複雜度** | **價值實現時間** | **優先級** | **狀態** |
|-------------|-----------|---------------|-------------------|--------------|---------|
| **1. 語義相似度檢索** 🆕 | **極高** | **低**（向量已存在） | 2 週 | **P0** | 新增 |
| **2. 同義詞擴展（基於同義詞庫）** | 高 | 低 | 1.5 週 | **P0** | 已有 |
| **3. 受讓人名稱標準化** | 高 | 低 | 1 週 | **P0** | 已有 |
| **4. 相鄰分類建議** | 高 | 中 | 2 週 | **P0** | 已有 |
| **5. 語義排名與聚類** 🆕 | **極高** | **低**（向量已存在） | 1.5 週 | **P0** | 新增 |
| **6. 查詢品質反饋** | 中 | 低 | 1 週 | **P1** | 已有 |
| **7. 進度指示器與逃生出口** | 中 | 低 | 0.5 週 | **P1** | 已有 |
| **8. 檢索歷史與快速重試** | 中 | 低 | 1 週 | **P1** | 已有 |
| **9. 專利家族去重 UI** | 中 | 中 | 1.5 週 | **P2** | 已有 |
| **10. 「類似此專利」擴展** 🆕 | **高** | **極低**（1 次向量查詢） | 0.5 週 | **P1** | 新增 |

**MVP v2 總範圍：** P0 + P1 功能 = **8 週**（時間不變，價值翻倍）

---

## 新增功能詳細規格

### 功能 1：語義相似度檢索 [P0] 🆕

**解決的瓶頸：** 詞彙不匹配、概念檢索、跨領域先前技術發現

**為何現在是快速見效：**

- ✅ **Solr 已有向量** - 零訓練成本
- ✅ **Solr 支援向量檢索** - 零基礎建設
- ✅ **只需 API 整合** - 2 週交付
- ✅ **立即高價值** - 發現關鍵字檢索錯過的專利

#### 需求

**FR1.1: 自然語言查詢理解**

- 將使用者的自然語言查詢轉換為向量
- 使用與 Solr 專利向量相同的嵌入模型
- 支援技術概念描述（例如「使用卡爾曼濾波器估算電池電量的方法」）

**FR1.2: 向量相似度檢索**

- 在 Solr 中執行向量 KNN（k-近鄰）檢索
- 返回前 K 個語義相似的專利（K = 100 預設）
- 結合關鍵字檢索與向量檢索（混合檢索）

**FR1.3: 混合檢索策略**

```
使用者查詢：「電池狀態估算使用機器學習」

AI 檢索策略：
┌────────────────────────────────────────────────────────────┐
│ 🔍 關鍵字檢索（精確匹配）                                     │
│ • "battery state" AND "estimation" AND "machine learning"  │
│ • 結果：1,234 件專利                                         │
│                                                             │
│ 🧠 語義檢索（概念相似）                                       │
│ • 將查詢轉換為向量嵌入                                        │
│ • 在 Solr 中執行向量相似度檢索                                │
│ • 結果：3,456 件專利（包含未用明確術語的相關專利）             │
│                                                             │
│ 🎯 混合檢索（最佳召回率 + 精確度）                            │
│ • 關鍵字結果（高精確度）：權重 60%                            │
│ • 語義結果（高召回率）：權重 40%                              │
│ • 去重後最終結果：4,123 件專利                                │
│                                                             │
│ 💡 語義檢索發現 2,889 件額外專利（+234% 召回率）             │
└────────────────────────────────────────────────────────────┘
```

**FR1.4: 語義匹配解釋**

- 顯示為何專利語義相似（匹配的概念）
- 高亮語義相關片段（即使用詞不同）
- 相似度分數（0-1）

**FR1.5: 語義檢索 UI**

```
檢索模式選擇：
┌────────────────────────────────────────────────────────────┐
│ ○ 關鍵字檢索（精確匹配，高精確度）                            │
│ ○ 語義檢索（概念相似，高召回率）                              │
│ ● 智能混合（推薦：平衡精確度與召回率）                        │
│                                                             │
│ 混合檢索權重：                                               │
│ 關鍵字 ████████████░░░░░░░░ 60%                            │
│ 語義   ██████░░░░░░░░░░░░░░ 40%                            │
│                                                             │
│ [進階設定] [重設為預設]                                      │
└────────────────────────────────────────────────────────────┘

結果範例：
┌────────────────────────────────────────────────────────────┐
│ 📄 US10234567B2 - Method for battery SoC estimation        │
│ 🎯 匹配類型：關鍵字 + 語義（相似度：0.92）                    │
│                                                             │
│ 語義匹配概念：                                               │
│ • "state of charge estimation" ≈ 您的查詢「電池狀態估算」    │
│ • "Kalman filter" ≈ 您提到的「機器學習」（統計推斷方法）      │
│ • "lithium-ion battery" ≈ 上下文中的「電池」                 │
│                                                             │
│ 💡 此專利未使用「機器學習」一詞，但使用相關的統計方法         │
└────────────────────────────────────────────────────────────┘
```

#### 技術設計

**查詢向量化：**

```python
# 使用與 Solr 專利向量相同的嵌入模型
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('allenai/specter')  # 專利領域模型
query_vector = model.encode("電池狀態估算使用機器學習")
# 返回：768 維向量 [0.123, -0.456, ...]
```

**Solr 向量檢索查詢：**

```json
// Solr KNN 查詢
{
  "q": "*:*",
  "fq": "{!knn f=patent_vector topK=100}[0.123, -0.456, ...]",
  "fl": "patent_id,title,abstract,score",
  "rows": 100
}
```

**混合檢索結合：**

```python
# 關鍵字檢索結果
keyword_results = solr.search(
    q="battery AND state AND estimation AND machine AND learning",
    rows=100
)

# 向量檢索結果
vector_results = solr.search(
    q="*:*",
    fq=f"{{!knn f=patent_vector topK=100}}{query_vector}",
    rows=100
)

# 混合排名（加權結合）
final_results = hybrid_rank(
    keyword_results, weight=0.6,
    vector_results, weight=0.4
)
```

**API 端點：**

```http
POST /api/v1/search/semantic
{
  "query": "電池狀態估算使用機器學習",
  "search_mode": "hybrid",  // "keyword" | "semantic" | "hybrid"
  "weights": {
    "keyword": 0.6,
    "semantic": 0.4
  },
  "top_k": 100
}

回應：
{
  "results": [
    {
      "patent_id": "US10234567B2",
      "title": "Method for battery SoC estimation",
      "semantic_similarity": 0.92,
      "keyword_score": 0.78,
      "final_score": 0.856,  // 0.92*0.4 + 0.78*0.6
      "match_type": "hybrid",
      "semantic_concepts": [
        { "query_term": "電池狀態估算", "matched_concept": "state of charge estimation", "similarity": 0.95 },
        { "query_term": "機器學習", "matched_concept": "Kalman filter", "similarity": 0.73 }
      ]
    }
  ],
  "stats": {
    "keyword_only": 1234,
    "semantic_only": 3456,
    "overlap": 567,
    "total_unique": 4123,
    "semantic_bonus": 2889  // 語義檢索發現的額外專利
  }
}
```

**實作工作量：** 2 週

- 第 1 週：
  - 第 1-2 天：驗證 Solr 向量欄位配置
  - 第 3-4 天：建置查詢向量化 API（使用相同的嵌入模型）
  - 第 5 天：實作 Solr KNN 查詢整合
- 第 2 週：
  - 第 1-2 天：實作混合檢索排名演算法
  - 第 3-4 天：前端 UI（檢索模式切換、權重調整）
  - 第 5 天：語義匹配解釋生成

**成功指標：**

- 召回率提升 **60%** vs. 純關鍵字檢索（使用 gold set 測試）
- 發現 **30%** 的相關專利未使用查詢關鍵字
- 使用者採用率 **70%**（選擇混合或語義模式）
- 語義相似度分數 **> 0.8** 的結果中，**85%** 被使用者評為相關

---

### 功能 5：語義排名與聚類 [P0] 🆕

**解決的瓶頸：** 篩選成本、結果組織

**為何現在是快速見效：**

- ✅ **向量已存在** - 可直接計算專利間相似度
- ✅ **聚類只需向量** - 無需額外特徵工程
- ✅ **即時排名** - 向量點積計算快速

#### 需求

**FR5.1: 向量相似度排名**

- 根據與查詢向量的餘弦相似度排序結果
- 結合其他訊號（專利日期、引用次數、法律狀態）
- 可調整權重（使用者偏好新專利 vs. 高引用專利）

**FR5.2: 結果聚類**

- 使用向量執行 K-means 或階層聚類
- 自動生成聚類標籤（從聚類中心最近的專利標題）
- 顯示每個聚類的大小和代表性專利

**FR5.3: 聚類 UI**

```
檢索結果：4,123 件專利，已聚類為 6 個概念群組

┌────────────────────────────────────────────────────────────┐
│ 📊 聚類視圖                                                  │
├────────────────────────────────────────────────────────────┤
│ 🔵 聚類 1: 卡爾曼濾波器估算方法（1,234 件，30%）              │
│    代表專利：US10234567 - Kalman filter for SoC             │
│    [展開] [只看此聚類]                                        │
│                                                             │
│ 🟢 聚類 2: 神經網路估算（892 件，22%）                        │
│    代表專利：US10876543 - Neural network battery model      │
│    [展開] [只看此聚類]                                        │
│                                                             │
│ 🟡 聚類 3: 庫侖計數法（654 件，16%）                          │
│    代表專利：US10345678 - Coulomb counting method           │
│    [展開] [只看此聚類]                                        │
│                                                             │
│ 🔴 聚類 4: 開路電壓法（543 件，13%）                          │
│ 🟣 聚類 5: 阻抗譜分析（432 件，10%）                          │
│ 🟠 聚類 6: 混合方法（368 件，9%）                             │
│                                                             │
│ [按相關性排序] [按聚類大小排序] [按日期排序]                  │
└────────────────────────────────────────────────────────────┘
```

**FR5.4: 聚類導覽**

- 點擊聚類展開顯示該群組的專利
- 「只看此聚類」篩選器
- 聚類間跳轉（探索相關概念）

#### 技術設計

**聚類演算法：**

```python
from sklearn.cluster import KMeans
import numpy as np

# 假設我們從 Solr 取得 4,123 件專利的向量
patent_vectors = np.array([
    solr_doc['patent_vector'] for solr_doc in results
])  # Shape: (4123, 768)

# K-means 聚類
n_clusters = min(6, len(results) // 200)  # 每聚類至少 200 件專利
kmeans = KMeans(n_clusters=n_clusters, random_state=42)
cluster_labels = kmeans.fit_predict(patent_vectors)

# 生成聚類標籤
for i in range(n_clusters):
    cluster_patents = [p for p, label in zip(results, cluster_labels) if label == i]
    # 找最接近聚類中心的專利
    center_vector = kmeans.cluster_centers_[i]
    closest_patent = min(
        cluster_patents,
        key=lambda p: cosine_distance(p['patent_vector'], center_vector)
    )
    cluster_label = extract_key_terms(closest_patent['title'])
    clusters.append({
        "id": i,
        "label": cluster_label,
        "size": len(cluster_patents),
        "representative_patent": closest_patent['patent_id']
    })
```

**API 端點：**

```http
POST /api/v1/search/cluster
{
  "search_id": "srch_abc123",
  "num_clusters": 6
}

回應：
{
  "clusters": [
    {
      "id": 0,
      "label": "卡爾曼濾波器估算方法",
      "size": 1234,
      "percentage": 30,
      "representative_patent": {
        "patent_id": "US10234567B2",
        "title": "Kalman filter for SoC estimation"
      },
      "patent_ids": ["US10234567", "US10234568", ...]
    },
    ...
  ]
}
```

**實作工作量：** 1.5 週

- 第 1-5 天：實作聚類演算法（K-means，使用 scikit-learn）
- 第 6-7 天：聚類標籤生成（關鍵詞提取）
- 第 8-10 天：前端聚類視圖 UI

**成功指標：**

- 使用者篩選時間減少 **40%**（透過聚類快速定位相關群組）
- **80%** 的使用者認為聚類標籤準確
- **60%** 的使用者使用聚類篩選功能
- 聚類內部一致性（silhouette score）**> 0.4**

---

### 功能 10：「類似此專利」擴展 [P1] 🆕

**解決的瓶頸：** 迭代檢索、發現相關專利

**為何是快速見效：**

- ✅ **單次向量查詢** - 極低複雜度
- ✅ **立即價值** - 使用者最愛功能之一
- ✅ **0.5 週實作** - 幾乎是免費功能

#### 需求

**FR10.1: 單點擊相似專利檢索**

- 在任何專利旁顯示「尋找類似專利」按鈕
- 使用該專利的向量執行 KNN 檢索
- 返回前 50 個最相似的專利

**FR10.2: UI**

```
📄 US10234567B2 - Method for battery SoC estimation

┌────────────────────────────────────────────────────────────┐
│ 摘要：This invention relates to estimating state of charge...│
│                                                             │
│ [📋 完整內容] [📊 引用分析] [🔍 尋找類似專利]               │
└────────────────────────────────────────────────────────────┘

點擊「尋找類似專利」後：
┌────────────────────────────────────────────────────────────┐
│ 🔍 類似於 US10234567B2 的專利（50 件）                       │
├────────────────────────────────────────────────────────────┤
│ 1. 📄 US10876543A1 - Advanced SoC estimation (相似度: 0.94)│
│    匹配原因：相同的卡爾曼濾波器方法，類似的應用場景           │
│                                                             │
│ 2. 📄 EP3456789A1 - Battery monitoring system (相似度: 0.89)│
│    匹配原因：相關的監控技術，不同的估算演算法                 │
│                                                             │
│ 3. 📄 JP2020-123456 - SoC prediction using ML (相似度: 0.85)│
│    匹配原因：類似的問題陳述，使用機器學習方法                 │
│                                                             │
│ [將全部加入檢索結果] [調整相似度閾值]                         │
└────────────────────────────────────────────────────────────┘
```

**FR10.3: 批量「類似專利」**

- 勾選多件專利，點擊「尋找類似這些專利的技術」
- 使用多個專利向量的平均作為查詢向量
- 適用於「我有 5 件相關專利，想找更多」的場景

#### 技術設計

**API 端點：**

```http
GET /api/v1/patent/{patentId}/similar?top_k=50

回應：
{
  "source_patent": {
    "patent_id": "US10234567B2",
    "title": "Method for battery SoC estimation"
  },
  "similar_patents": [
    {
      "patent_id": "US10876543A1",
      "title": "Advanced SoC estimation",
      "similarity": 0.94,
      "match_reason": "相同的卡爾曼濾波器方法，類似的應用場景"
    },
    ...
  ]
}
```

**實作工作量：** 0.5 週（3-4 天）

- 第 1-2 天：API 端點（直接 Solr KNN 查詢）
- 第 3 天：前端按鈕與對話框 UI
- 第 4 天：批量「類似專利」功能

**成功指標：**

- **50%** 的使用者在會話中使用此功能
- 透過「類似專利」發現的平均額外相關專利數：**15 件**
- 使用者滿意度：**90%**（最受歡迎功能之一）

---

## 使用者故事 (User Stories)

### US1: 專利審查員 - 全面先前技術檢索

**身分：** 專利審查員，正在審查一件電池管理系統申請案
**需求：** AI 檢索自動找到語義相似的專利（包含多語言和相鄰分類）
**目的：** 無需手動探索數十個 CPC 子類和外語資料庫，即可識別所有相關先前技術

**驗收標準：**

- ✅ 查詢「電池狀態估算使用卡爾曼濾波器」返回來自 H01M10/42、H01M10/48、H02J7/00、G01R31/36 的結果
- ✅ 語義檢索發現使用「狀態推斷」、「SoC 預測」等不同術語的相關專利（+30% 召回率）
- ✅ 結果自動聚類為「卡爾曼濾波器方法」、「神經網路方法」等主題
- ✅ 前 100 個結果的誤報率 < 20%

**MVP v2 解決方案：**

- 🚀 **語義檢索**：找到未使用「卡爾曼濾波器」字眼但概念相似的專利
- 🚀 **自動聚類**：將結果組織為技術主題，快速定位相關群組
- 🚀 **相鄰分類建議**：自動推薦 H02J7/00（充電電路）等相關分類

---

### US2: IP 律師 - 競爭對手技術景觀分析

**身分：** IP 律師，研究競爭對手的專利組合
**需求：** AI 檢索統一變體受讓人名稱並按技術主題聚類結果
**目的：** 無需手動分組數百件專利，即可快速了解競爭對手的技術重點領域

**驗收標準：**

- ✅ 「Samsung Electronics」查詢包含「삼성전자」、「Samsung Electronics Co Ltd」、「Samsung SDI」
- ✅ 總結果從 45,234 件（僅精確匹配）增加到 89,703 件（+97% 召回率）
- ✅ 結果自動聚類為 5-10 個連貫主題並附帶可讀標籤（例如「OLED 顯示技術」、「5G 通訊」）
- ✅ 每個聚類顯示專利數量和代表性專利

**MVP v2 解決方案：**

- 🚀 **受讓人標準化**：自動識別並統一 Samsung 的所有變體名稱
- 🚀 **語義聚類**：使用向量自動將專利分組為技術主題
- 🚀 **聚類標籤生成**：自動生成可讀的主題標籤（非「聚類 1」）

---

### US3: 研究人員 - 跨領域技術探索

**身分：** 大學研究人員，探索燃料電池應用
**需求：** AI 檢索建議出現類似電化學概念的非明顯分類
**目的：** 發現超出我直接領域的跨領域創新機會

**驗收標準：**

- ✅ 「質子交換膜」查詢建議 H01M8/10（燃料電池）AND C25B13/08（電解）AND B01D71/02（膜分離）的結果
- ✅ 為每個分類提供相關性解釋（例如「膜分離技術適用於氣體純化」）
- ✅ 至少建議一個意外但語義連貫的分類
- ✅ 透過語義檢索發現 20% 的結果來自非主要分類

**MVP v2 解決方案：**

- 🚀 **語義檢索**：找到概念相似但在不同領域的專利（跨領域發現）
- 🚀 **相鄰分類建議**：推薦非明顯的交叉參考分類
- 🚀 **分類覆蓋率分析**：顯示結果在各分類的分佈，突出顯示意外發現

---

### US4: 新手檢索者 - 引導式首次檢索

**身分：** 新創公司創辦人，無專利檢索經驗
**需求：** AI 檢索引導我建構查詢並解釋為何結果過於寬泛或過於狹窄
**目的：** 無需聘請昂貴的專利律師即可達到良好的檢索品質

**驗收標準：**

- ✅ 初始查詢「AI 推薦系統」被標記為過於寬泛（120 萬件結果）
- ✅ 提供建議：按應用領域縮小範圍、添加分類篩選器、指定技術方法
- ✅ 系統自動識別 10 件相關專利作為參考集（gold set）
- ✅ 改進後，相對於專家基準達到 70% 以上召回率
- ✅ 查詢品質反饋清晰易懂（新手友善的語言）

**MVP v2 解決方案：**

- 🚀 **查詢品質反饋**：即時偵測過寬/過窄並提供可操作建議
- 🚀 **同義詞擴展**：自動建議「推薦引擎」、「協同過濾」等術語
- 🚀 **語義檢索**：即使新手使用不精確的術語，也能找到相關專利
- 🚀 **進度指示器**：透明顯示 AI 正在做什麼（建立信任）

---

### US5: 專利分析師 - 使用 Gold Set 迭代改進

**身分：** 專利分析師，驗證自由實施檢索 (FTO)
**需求：** 輸入 10 件已知阻礙專利並測量我的查詢是否全部找到
**目的：** 客觀評估檢索品質並識別策略中的差距

**驗收標準：**

- ✅ 系統接受使用者輸入的 10 個已知專利編號作為 gold set
- ✅ 執行檢索後，系統報告「找到 8/10」並解釋 2 件遺漏的原因
  - 例如：「US9876543 分類在意外的 Y10S（交叉參考）」
  - 例如：「EP3456789 德語原文未索引特定術語」
- ✅ 提供建議以恢復遺漏的專利（例如「添加 Y10S 分類」、「使用語義檢索」）
- ✅ 最終改進的查詢達到 10/10 召回率
- ✅ 顯示每件遺漏專利的恢復路徑

**MVP v2 解決方案：**

- 🚀 **語義檢索**：找到使用不同術語的已知專利（減少遺漏）
- 🚀 **檢索歷史比較**：並排比較查詢變體，查看召回率變化
- 🚀 **誤報分析**：解釋為何遺漏（分類、術語、語言）

---

### US6: 技術專家 - 「類似此專利」探索 🆕

**身分：** 電池技術專家，找到一件極相關的專利
**需求：** 單點擊找到技術上類似的專利，無需重新建構查詢
**目的：** 快速擴展檢索以發現相關技術和潛在先前技術

**驗收標準：**

- ✅ 在任何專利旁有「尋找類似專利」按鈕
- ✅ 單點擊返回 50 件最相似的專利（< 2 秒）
- ✅ 顯示相似度分數和匹配原因（例如「相同的電化學原理」）
- ✅ 平均發現 15 件先前未在檢索結果中的相關專利
- ✅ 可批量選擇 5 件專利並找到「類似這些專利的技術」

**MVP v2 解決方案：**

- 🚀 **單次向量查詢**：使用專利的現有向量執行 KNN 檢索
- 🚀 **實作時間 0.5 週**：幾乎是免費功能
- 🚀 **最受歡迎功能**：使用者最愛的快速探索工具

---

### US7: 研發團隊 - 自動聚類主題探索 🆕

**身分：** 研發團隊領導，執行技術景觀分析
**需求：** 自動將 5,000 件檢索結果組織為主題群組
**目的：** 快速識別主要技術趨勢和研究熱點，無需手動閱讀數千件專利

**驗收標準：**

- ✅ 5,000 件結果自動聚類為 6-10 個主題
- ✅ 每個聚類有可讀標籤（例如「固態電池技術」、「快速充電方法」）
- ✅ 顯示聚類大小和百分比（例如「1,234 件，25%」）
- ✅ 點擊聚類只顯示該群組的專利
- ✅ 篩選時間從 3 小時減少到 1 小時（-67%）
- ✅ 80% 的使用者認為聚類標籤準確

**MVP v2 解決方案：**

- 🚀 **向量聚類**：K-means 自動分組語義相似的專利
- 🚀 **自動標籤**：從聚類中心提取關鍵概念
- 🚀 **視覺化**：直觀的聚類大小分佈圖

---

### US8: 多語言檢索者 - 跨語言概念發現 🆕

**身分：** 跨國公司 IP 經理，需要檢索全球專利
**需求：** 即使使用英語查詢也能找到日文、韓文、中文專利
**目的：** 發現亞洲市場的相關先前技術，避免翻譯品質問題

**驗收標準：**

- ✅ 英語查詢「solid-state battery」找到使用「固体電池」（JP）、「고체 배터리」（KR）、「固態電池」（CN）的專利
- ✅ 語義檢索跨越語言障礙（向量在多語言空間中相似）
- ✅ 結果包含至少 30% 的非英語專利
- ✅ 不依賴機器翻譯品質（向量相似度 > 翻譯文字匹配）

**MVP v2 解決方案：**

- 🚀 **多語言向量**：如果 Solr 向量是多語言模型訓練（需確認），可跨語言檢索
- 🚀 **語義相似度**：不受術語翻譯變化影響
- 🚀 **未來增強**：多語言查詢擴展（Phase 2）

---

## 使用者故事總結

| 使用者角色 | 核心需求 | MVP v2 關鍵功能 | 預期影響 |
|----------|---------|---------------|---------|
| **專利審查員** | 全面先前技術 | 語義檢索 + 聚類 | 召回率 +60% |
| **IP 律師** | 競爭對手分析 | 受讓人標準化 + 聚類 | 分析時間 -50% |
| **研究人員** | 跨領域發現 | 語義檢索 + 分類建議 | 發現隱藏技術 +30% |
| **新手檢索者** | 引導式學習 | 查詢品質反饋 + 同義詞 | 達到專家 70% 品質 |
| **分析師** | 品質驗證 | Gold set + 檢索比較 | 召回率測量 10/10 |
| **技術專家** | 快速探索 | 「類似專利」 | 每次 +15 件相關專利 |
| **研發團隊** | 主題識別 | 自動聚類 | 篩選時間 -67% |
| **多語言檢索者** | 全球覆蓋 | 語義跨語言 | 非英語專利 +30% |

---

## 更新後的實作計畫（8 週）

### 衝刺 1-2（第 1-2 週）：語義核心 [P0] 🆕

**目標：** 語義檢索 + 同義詞擴展

**第 1 週：**

- [x] 第 1-2 天：驗證 Solr 向量配置，測試 KNN 查詢
- [x] 第 3-4 天：建置查詢向量化服務（使用相同嵌入模型）
- [x] 第 5 天：實作 Solr 向量檢索 API

**第 2 週：**

- [x] 第 1-2 天：實作混合檢索（關鍵字 + 語義）排名
- [x] 第 3 天：同義詞庫建置（從 CPC 定義）
- [x] 第 4 天：同義詞擴展 API
- [x] 第 5 天：前端語義檢索 UI（模式切換、權重調整）

**交付成果：** 使用者可執行語義檢索並擴展同義詞

---

### 衝刺 3-4（第 3-4 週）：智能組織 [P0]

**目標：** 語義聚類 + 分類建議 + 受讓人標準化

**第 3 週：**

- [x] 第 1-3 天：實作向量聚類演算法（K-means）
- [x] 第 4-5 天：聚類標籤生成與前端 UI

**第 4 週：**

- [x] 第 1-2 天：CPC/IPC 階層圖建置
- [x] 第 3 天：相鄰分類建議 API
- [x] 第 4 天：受讓人變體資料庫與模糊匹配 API
- [x] 第 5 天：前端分類與受讓人 UI

**交付成果：** 結果自動聚類，建議相鄰分類與受讓人變體

---

### 衝刺 5-6（第 5-6 週）：UX 精煉 [P1]

**目標：** 查詢品質反饋 + 進度指示器 + 檢索歷史 + 「類似專利」

**第 5 週：**

- [x] 第 1-2 天：查詢品質啟發式規則與 UI
- [x] 第 3 天：進度指示器 UI
- [x] 第 4-5 天：「類似此專利」功能（API + UI）

**第 6 週：**

- [x] 第 1-3 天：檢索歷史資料庫與 UI
- [x] 第 4-5 天：檢索比較功能

**交付成果：** 完整的使用者體驗精煉

---

### 衝刺 7-8（第 7-8 週）：測試與精煉 [P2]

**目標：** 整合測試 + 家族去重 + Beta 測試

**第 7 週：**

- [x] 第 1-3 天：端對端測試（語義檢索準確度、聚類品質）
- [x] 第 4-5 天：效能最佳化（向量檢索延遲、聚類速度）

**第 8 週：**

- [x] 第 1-2 天：專利家族去重 UI
- [x] 第 3-4 天：Beta 使用者測試（20 名內部使用者）
- [x] 第 5 天：文件與部署準備

**交付成果：** 生產就緒的 AI 檢索系統

---

## 更新後的成功指標

### 使用者影響指標（v2 提升）

| 指標 | 基準 | MVP v1 目標 | **MVP v2 目標** | 改進 |
|--------|----------|------------|------------|------|
| **查詢建構時間** | 10 分鐘 | 6 分鐘（-40%） | **5 分鐘（-50%）** | 🚀 +10% |
| **召回率** | 基準 | +25% | **+60%** | 🚀 +35% |
| **受讓人檢索準確度** | 40% | 90%（+60%） | **90%（+60%）** | ✓ 維持 |
| **篩選時間** | 20 分鐘 | 20 分鐘 | **12 分鐘（-40%）** | 🚀 新增 |
| **使用者滿意度（CSAT）** | 65% | 80%（+15 點） | **85%（+20 點）** | 🚀 +5 點 |
| **隱藏先前技術發現** | - | - | **+30%** | 🚀 新能力 |

### 新功能採用指標

| 功能 | 目標採用率 | 預期影響 |
|---------|----------------|----------|
| **語義檢索** 🆕 | **70%** 選擇混合或語義模式 | 召回率 +60% |
| **結果聚類** 🆕 | **60%** 使用聚類篩選 | 篩選時間 -40% |
| **「類似專利」** 🆕 | **50%** 在會話中使用 | 每次發現 +15 件相關專利 |
| 同義詞擴展 | 60% 接受 ≥1 建議 | 查詢品質 +30% |
| 受讓人標準化 | 70% 選擇 ≥1 變體 | 受讓人召回 +60% |
| 相鄰分類 | 40% 添加 ≥1 類別 | 分類覆蓋 +25% |

### 技術效能指標

| 指標 | 目標 | 警報閾值 |
|--------|--------|-----------------|
| **向量檢索延遲** 🆕 | < 1.5 秒 P95 | > 3 秒 |
| **聚類計算時間** 🆕 | < 2 秒（100 件專利） | > 5 秒 |
| **混合檢索總延遲** 🆕 | < 5 秒 P95 | > 10 秒 |
| 同義詞擴展延遲 | < 1 秒 P95 | > 2 秒 |
| 受讓人標準化延遲 | < 500 毫秒 P95 | > 1 秒 |
| API 錯誤率 | < 0.5% | > 1% |

---

## 語義檢索測試策略

### 語義準確度測試

**測試資料集：** 100 個手動標記的查詢-專利對

**測試場景：**

1. **同義詞測試**
   - 查詢："battery" → 應找到使用 "cell"、"accumulator" 的專利
   - 預期召回率：**> 90%**

2. **概念測試**
   - 查詢："machine learning for battery" → 應找到使用 "neural network"、"Kalman filter" 的專利
   - 預期召回率：**> 75%**（較寬泛的概念匹配）

3. **跨領域測試**
   - 查詢："cooling system" → 應找到電池冷卻（H01M）和 HVAC（F28）專利
   - 預期：至少 **20%** 結果來自非主要分類

**評估指標：**

- **MAP@10** (Mean Average Precision)：**> 0.75**
- **NDCG@10** (Normalized Discounted Cumulative Gain)：**> 0.80**
- **Recall@100** vs. 關鍵字檢索：**+60%**

### 聚類品質測試

**評估指標：**

- **Silhouette Score**：**> 0.4**（聚類內部一致性）
- **聚類標籤準確度**：**80%** 使用者認為標籤準確
- **聚類大小平衡**：最大聚類 < 40% 總結果（避免過度集中）

---

## 與原始 MVP v1 的比較

### 功能對比

| 面向 | MVP v1（無向量） | MVP v2（有向量） | 提升 |
|------|----------------|----------------|------|
| **核心能力** | 關鍵字增強 | 關鍵字 + 語義 | 🚀🚀🚀 |
| **召回率** | +25% | **+60%** | 🚀 +140% |
| **隱藏先前技術** | 無 | **+30%** | 🚀 新能力 |
| **結果組織** | 無 | **自動聚類** | 🚀 新能力 |
| **「類似專利」** | 無 | **單點擊** | 🚀 新能力 |
| **使用者滿意度** | 80% | **85%** | 🚀 +6% |
| **開發時間** | 8 週 | **8 週** | ✓ 相同 |
| **基礎建設成本** | $0 | **$0** | ✓ 零額外成本 |

### ROI 分析

**MVP v1 價值：**

- 同義詞擴展：40% 查詢時間減少
- 分類建議：25% 召回率提升
- 受讓人標準化：60% 準確度提升
- **總價值：** 中等

**MVP v2 價值（+語義檢索）：**

- MVP v1 所有功能 ✓
- **語義檢索：60% 召回率提升**（單一功能的最大影響）
- **自動聚類：40% 篩選時間減少**
- **隱藏先前技術發現：30% 新專利**
- **「類似專利」：平均 +15 件相關專利**
- **總價值：** 極高

**投資回報：**

- **開發成本：** 相同（8 週）
- **基礎建設成本：** $0（向量已存在）
- **價值提升：** **+150%** vs. MVP v1
- **ROI：** **無限**（零額外成本獲得巨大價值）

---

## 開放問題（更新）

### 技術問題

1. **Solr 向量欄位詳情：**
   - 向量維度是多少？（假設 768 維，需確認）
   - 使用的嵌入模型是什麼？（需要相同模型用於查詢向量化）
   - Solr 版本支援 KNN 嗎？（Solr 9+ 原生支援，舊版需外掛）
   - **需要決定時間：** 第 1 週第 1 天（影響技術可行性）

2. **向量檢索效能：**
   - Solr KNN 在 150M 專利上的延遲是多少？
   - 是否需要建置 HNSW 索引以加速？
   - **需要決定時間：** 第 1 週第 2 天（影響效能優化策略）

3. **嵌入模型授權：**
   - 專利向量是使用哪個模型生成的？（SPECTER, Patent-BERT, 其他？）
   - 我們是否有授權使用該模型用於查詢向量化？
   - **需要決定時間：** 第 1 週第 3 天（影響合規性）

### 產品問題

4. **混合檢索預設權重：**
   - 關鍵字 vs. 語義的最佳預設權重？（建議：60/40）
   - 不同使用者群體是否需要不同預設？（審查員 vs. 研究員）
   - **需要決定時間：** 第 2 週（影響 UX 設計）

5. **聚類數量：**
   - 自動聚類應生成多少個聚類？（建議：6-10）
   - 是否允許使用者自訂聚類數量？
   - **需要決定時間：** 第 3 週（影響聚類 UI）

6. **「類似專利」閾值：**
   - 相似度分數多少以上才顯示為「類似」？（建議：> 0.7）
   - 最多返回多少件類似專利？（建議：50）
   - **需要決定時間：** 第 5 週（影響功能設計）

---

**建立日期：** 2025-10-19
**最後更新：** 2025-10-19
**版本：** 2.0（利用 Solr 向量）
**負責人：** AI Search Team (PatentCloud by InQuartik)
**憲法對齊：** v1.1.0
**相關文件：**

- `ai-search-feature.md`（完整路線圖）
- `ai-search-mvp-low-hanging-fruit-zh-TW.md`（v1 基準）
